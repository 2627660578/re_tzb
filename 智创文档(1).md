## 功能

---
    由于题目要求的最后一点中提到，用户使用的次数算在分数中，具体又分为调用api的次数
    和在agent平台上的点击次数和对话次数，但是只能有一个工作流参加比赛因此我们最好
    需要实现一个工作流两路复用的效果，即这个工作流可以直接在平台上进行对话，
    也可以通过api进行调用。

### 一、用户入口：
1、网站入口
- 直接进入网站
- 在agent平台上点击我们发布的智能体，自动弹出我们的网站与提示“
进入网站可获得更好的体验”，用户可以选择点击进入网站进行后续操作

2、智能体入口
- 在agent平台上点击我们发布的智能体，自动弹出我们的网站与提示“进入网站可获得更好的体验”，
但是用户不想在网站上进行操作，于是没有点击链接，继续在相同的智能体聊天页面上接着进行对话。

### 二、网站效果
(这个还是之前的版本，还没有改！)

1、路径1，用户明确需要生成文章

- 用户点击链接，进入网站，发现一个输入框和一个编辑框
- 用户在输入框中给出要求和信息（无论信息多少）
- 用户点击提交按钮，前端将输入框中的内容传入后端（用户第一次交互）
- 后端调用智能体的工作流api，工作流将输入传入智能体
- 智能体接收到用户的要求和信息进行处理
  - 智能体1处理用户要求：生成撰写文章所需要的内容清单
  - 智能体2处理用户信息：将用户给的信息进行整理拆分，填写到智能体1生成的内容清单中
  - 这一步如果用户没有给信息，那么智能体2将不进行整理拆分
  - 最终工作流通过问答模块将回答返回给后端，返回内容的格式是“内容清单：内容”。如下：
    - 文章标题：hello大模型
    - 文章内容：
    - 文章发布时间：2025-7-15
  - 如果用户没有给对应信息，那么内容清单冒号后面的内容将为空
- 后端接收到智能体的回答，将内容清单和内容返回给前端
- 前端将内容清单和内容填入编辑框中
- 用户可以在编辑框中对内容清单和内容进行修改，比如对内容清单后面空着的
  内容进行填写，或者对内容进行修改，最后点击生成按钮（用户第二次交互）
- 前端将编辑框中的内容传入后端
- 后端调用智能体的工作流api，将编辑框中的内容传入工作流
- 智能体根据用户编辑的内容进行处理
  - 智能体3生成文章和排版格式（如果用户有自定义模板，可以让用户选择模板，
让前端传回用户选择的模板id，这时候智能体3就会根据用户给的模板对文章进行排版）
- 工作流结束，结果返回给后端，后端将结果返回给前端，前端展示在编辑框中。

补充说明：
- 如果后续自己写知识库，让用户自定义知识库之后， 前端可以添加一个按钮，让用户
选择是否使用知识库，然后照常发送请求（这里判断是否选择知识库的字段要一开始就留好）
后端会自动调用知识库检索，将检索到的知识当作用户的输入内容照常传递到工作流中，智能体2
会根据用户的输入内容和知识库检索到的内容进行整理拆分，最后还是填写到内容清单中返回给用户




### 三、agent平台效果
- 跟网页一样，不过只有对话框能交互


### 四、数据协议

错误信息
```
{
  "error": {
    "code": "ERROR_CODE_STRING", // 例如: 402
    "message": "具体的错误描述信息。"
  }
}
```

1. 核心交互接口

POST 47.98.215.181:8010/llmcenter/v1/chat/completions

功能: 发起新对话或在现有对话中发送消息。
一定要登录

➡️ 前端发送的数据对象 (Request)
```
{
  "conversation_id": "",
  "documenttype": "通知",
  "information": "地点：上海分公司，时间：2025.10.12，主题：股东大会",
  "requests": "语气严肃一点",
  "use_knowledge_base": false,
  "knowledge_base_id": "",
  "references": [
      {
      "type": "file",
      "file_id": "82f09dd3-5e33-4bdc-be17-18dc63831e6f.png" 
      }
  ]
}
```

- conversation_id (string, 可选): 现有会话ID。如果为空，后端将创建新会话。

- documenttype (string, 必选): 公文类型。

- information (string, 必选): 公文基础信息。

- requests (string, 必选): 用户提出的要求。

- use_knowledge_base (boolean, 可选): 是否使用自定义知识库，默认为 false。

- knowledge_base_id (string, 可选): 如果 use_knowledge_base 为 true，则需要提供知识库ID。

- refrence 可选


⬅️ 后端返回的数据对象 (Response)

这是一个 流式 (Server-Sent Events) 响应，由多种事件类型构成。前端需要监听并分别处理。

```
事件类型: message (用于闲聊或最终文档生成的流式文本)
event: message
data: {
  "chunk": "AI在当今世界扮演着越来越..."
}
```
- chunk: 流式返回的文本片段。
```
事件类型: interrupt (用于触发文档生成，返回内容清单)

event: interrupt
data: {
  "conversation_id": "conv_xxx",
  "message_id": "msg_yyy",
  "content_type": "document_outline",
  "content": "文章标题：AI赋能未来\n文章大纲：\n- 引言\n- AI的核心技术\n- 结论",
}
```
- content_type: 告诉前端这是文档大纲 (document_outline)。

- content: 需要填入编辑器的内容清单。


```
事件类型: end (表示一次完整的对话或流结束)

event: end
data: {
  "conversation_id": "conv_xxx",
  "message_id": "msg_zzz"
}
```
- conversation_id: 本次交互所属的会话ID。

- message_id: 本次交互最终生成的完整消息ID。



POST  47.98.215.181:8010/llmcenter/v1/chat/resume

功能: 在工作流中断后，发送用户编辑好的内容以继续流程（生成最终文档）。
```
➡️ 前端发送的数据对象 (Request)

{
    "conversation_id": "conv_xxx",
    "content": "文章标题：AI赋能：医疗行业的革命\n文章大纲：...\n文章发布时间：2025-07-17",
    "template_id": "tpl_123"
}
```
- conversation_id (string, 必选): 当前会话的ID。

- content (string, 必选): 用户在前端编辑器中确认后的完整内容。

- template_id (string, 可选): 如果用户在这一步更改了模板。

⬅️ 后端返回的数据对象 (Response)

这是一个 流式 (Server-Sent Events) 响应，返回最终生成的文档。只包含 message 和 end 事件。
```
事件类型: message

event: message
data: {
  "chunk": "## AI赋能：医疗行业的革命\n\n在21世纪..."
}
```
- chunk: 最终生成的文档的文本片段。
```
事件类型: end

event: end
data: {
  "conversation_id": "conv_xxx",
  "message_id": "msg_final_doc"
}
```

POST  47.98.215.181:8010/llmcenter/v1/chat/edit

功能: 在生成公文后，发送用户的修改要求进一步修改。
```
➡️ 前端发送的数据对象 (Request)

{
    "conversation_id": "conv_xxx",
    "message_id": "msg_zzz", 
    "prompt": "请帮我把时间改为2025.2.10", 
    "use_knowledge_base": false,
    "knowledge_base_id": ""
}
```
- conversation_id (string, 必选): 当前会话的ID。

- message_id (string, 必选): 需要修改文章的ID。

- prompt (string, 必选): 用户的修改要求。

- use_knowledge_base (bool, 必选): 是否使用知识库。

- knowledge_base_id (string, 可选): 知识库编号（若用户选择使用数据库）。

⬅️ 后端返回的数据对象 (Response)

这是一个 流式 (Server-Sent Events) 响应，返回更改后的文档。只包含 message 和 end 事件。
```
事件类型: message

event: message
data: {
  "chunk": "## AI赋能：医疗行业的革命\n\n在21世纪..."
}
```
- chunk: 最终生成的文档的文本片段。
```
事件类型: end

event: end
data: {
  "conversation_id": "conv_xxx",
  "message_id": "msg_final_doc"
}
```

POST  47.98.215.181:8010/llmcenter/v1/chat/update

功能: 在生成公文后，保存用户的手动修改内容。
```
➡️ 前端发送的数据对象 (Request)

{
    "conversation_id": "conv_xxx",
    "message_id": "msg_zzz", 
    "prompt": "修改后的文章内容"
}
```
- conversation_id (string, 必选): 当前会话的ID。

- message_id (string, 必选): 需要修改文章的ID。

- prompt (string, 必选): 修改后的文章内容。

⬅️ 后端返回的数据对象 (Response)
```
{
    "success": true
}
```

2. 用户中心接口

POST 47.98.215.181:8000/usercenter/v1/user/login

功能: 用户登录。

➡️ 前端发送的数据对象 (Request)
```
{
    "mobile":"12345678912",
    "password":"12345"
}
```

- mobile (string, 必选): 用户手机号。
- 
- password (string, 必选): 用户填入的密码。


⬅️ 后端返回的数据对象 (Response)

```
{
    "code": 0,
    "msg": "ok",
    "data": {
        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3ODUwNDY2ODcsImlhdCI6MTc1MzUxMDY4Nywiand0VXNlcklkIjo0fQ.sGrh1h3BCRzKkpM5CNaqjePVZnvYQ5G5i3DJiMOVaHY",
        "accessExpire": 1785046687,
        "refreshAfter": 1769278687
    }
}
```
- accessToken: 服务器分配给用户的JWT访问令牌（用于身份验证）。
- 
- accessExpire: 令牌过期时间（Unix时间戳）。
- 
- refreshAfter: 建议刷新令牌的时间（Unix时间戳）。


POST  47.98.215.181:8000/usercenter/v1/user/register

功能: 用户注册。
```
➡️ 前端发送的数据对象 (Request)

{
    "mobile":"12345678912",
    "password":"123456"
}
```

- mobile (string, 必选): 用户手机号。
- 
- password (string, 必选): 用户填入的密码。

⬅️ 后端返回的数据对象 (Response)
```
{
    "code": 0,
    "msg": "ok",
    "data": {
        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3ODUwNDY2ODcsImlhdCI6MTc1MzUxMDY4Nywiand0VXNlcklkIjo0fQ.sGrh1h3BCRzKkpM5CNaqjePVZnvYQ5G5i3DJiMOVaHY",
        "accessExpire": 1785046687,
        "refreshAfter": 1769278687
    }
}
```

- accessToken: 服务器分配给用户的JWT访问令牌（用于身份验证）。
- 
- accessExpire: 令牌过期时间（Unix时间戳）。
- 
- refreshAfter: 建议刷新令牌的时间（Unix时间戳）。

POST  47.98.215.181:8000/usercenter/v1/user/detail

功能: 用户注册。

➡️ 前端发送的数据对象 (Request)

```
无请求体。用户信息通过Header中的认证令牌（如JWT）传递。
```

⬅️ 后端返回的数据对象 (Response)
```
{
    "code": 0,
    "msg": "ok",
    "data": {
        "userInfo": {
            "id": 4,
            "mobile": "19818260400",
            "nickname": "用户wFCY"
        }
    }
}
```

- id: 用户ID（唯一标识）。
- 
- mobile: 用户手机号。
- 
- nickname: 用户昵称。


3. 文件上传接口

POST 47.98.215.181:8010/llmcenter/v1/files/upload
功能: 上传文件（支持jpg、jpeg、png、txt、md、csv、docx、pdf、xlsx、pptx），用于后续对话。

➡️ 前端发送的数据对象 (Request)
```
请求体格式为: multipart/form-data

表单字段键 (key) 为: file

值 (value) 为: 用户选择的文件对象。
```
⬅️ 后端返回的数据对象 (Response)
 这里需要写一个定时清除file的函数，同时也清除数据库的id
```
成功 (200 OK)

{
    "file_id": "file_12345",
    "file_name": "my_document.pdf",
    "url": "https://service-provider.com/files/xxxx.pdf",
    "message": "文件上传成功"
}
```
- file_id: 后端生成的唯一文件ID，用于在prompt中引用。

- url (可选): 文件的可访问URL。

失败
```
{
  "error": {
    "code": "UPLOAD_FAILED",
    "message": "文件上传失败，可能文件过大或格式不支持。"
  }
}
```
4. 历史记录接口

GET 47.98.215.181:8010/llmcenter/v1/conversations
功能: 获取当前用户的会话列表。

➡️ 前端发送的数据对象 (Request)
```
无请求体。用户信息通过Header中的认证令牌（如JWT）传递。
```
⬅️ 后端返回的数据对象 (Response)

成功 (200 OK)
```
{
  "data": [
    {
      "conversation_id": "conv_xxx",
      "title": "关于大模型的文章",
      "updated_at": "2025-07-16T10:00:00Z"
    },
    {
      "conversation_id": "conv_yyy",
      "title": "你好",
      "updated_at": "2025-07-15T14:30:00Z"
    }
  ]
}
```
GET 47.98.215.181:8010/llmcenter/v1/conversations/{conversation_id}
功能: 获取指定会话的详细修改文章页面的历史消息。

➡️ 前端发送的数据对象 (Request)
```
无请求体。conversation_id 通过 URL 路径传递。
```
⬅️ 后端返回的数据对象 (Response)

成功 (200 OK)
```
{
    "code": 0,
    "msg": "ok",
    "data": {
        "conversation_id": "01K1TRT3ACF8DV9BTA1DWVYW2Z",
        "title": "地点：上海分公司，时间：202...",
        "history": [
            {
                "id": "01K1TS0WAT1NNRCHZ266BF5SKH",
                "role": "assistant",
                "content": "**关于召开2025年度股东大会的通知**……………………………………",
                "content_type": "text",
                "created_at": "2025-08-04T22:51:17+08:00"
            },
            {
                "id": "01K1TS1FSPJ218X710J95PS9CK",
                "role": "user",
                "content": "请帮我把时间改为2025.6.10",
                "content_type": "text",
                "created_at": "2025-08-04T22:51:17+08:00"
            },
            {
                "id": "01K1TS5T4FRCA1RCFFXSFD04WC",
                "role": "assistant",
                "content": "**关于召开2025年度股东大会的通知**……………………………………",
                "content_type": "text",
                "created_at": "2025-08-04T22:53:58+08:00"
            },
            {
                "id": "01K1TS6DQ8XDPRCVDWCP8G9AZN",
                "role": "user",
                "content": "请帮我把时间改为2025.2.10",
                "content_type": "text",
                "created_at": "2025-08-04T22:53:58+08:00"
            }
        ]
    }
}
```
- role: 角色，user 或 assistant。

GET 47.98.215.181:8010/llmcenter/v1/documents/{conversation_id}
功能: 获取指定会话最终生成的文档。

➡️ 前端发送的数据对象 (Request)
```
无请求体。conversation_id 通过 URL 路径传递。
```
⬅️ 后端返回的数据对象 (Response)

成功 (200 OK)
```
{
    "conversation_id": "01K1TRT3ACF8DV9BTA1DWVYW2Z",
    "documents": [
        {
            "id": "01K1TRYXX408S8FSH8FCKN4Y7V",
            "content": "**关于召开2025年度股东大会的通知**………………………………",
            "created_at": "2025-08-04T22:49:53+08:00"
        }
    ]
}
```

GET 47.98.215.181:8010/llmcenter/v1/historydatas/{conversation_id}
功能: 获取指定会话第一个页面的基本信息。

➡️ 前端发送的数据对象 (Request)
```
无请求体。conversation_id 通过 URL 路径传递。
```
⬅️ 后端返回的数据对象 (Response)

成功 (200 OK)
```
{
    "conversation_id": "01K1TRT3ACF8DV9BTA1DWVYW2Z",
    "items": [
        {
            "id": "01K1TRT3H3R3Q5ER4ND7TX4M33",
            "documenttype": "通知",
            "information": "地点：上海分公司，时间：2025.10.12，主题：股东大会",
            "requests": "语气严肃一点",
            "created_at": "2025-08-04T22:47:15+08:00",
            "references": [
                {
                    "file_id": "82f09dd3-5e33-4bdc-be17-18dc63831e6f.png",
                    "filename": "1.png"
                }
            ]
        }
    ]
}
```
- documenttype: 文档类型。

- information: 生成公文的基础消息。

- requests: 用户提出的要求。

- file_id: 上传文件的哈希值（用于从服务器请求相应的文件）。

- filename: 上传文件的名称，若时间过长被服务器删除则会显示“文件已过期或不存在”。


5. 多媒体文件请求接口

GET 47.98.215.181:8010/llmcenter/v1/files/{path}
功能: 获取服务器相应文件（如图片、pdf等）。

➡️ 前端发送的数据对象 (Request)
```
无请求体。path 通过 URL 路径传递。
```
⬅️ 后端返回的数据对象 (Response)

```
返回相应文件
```

